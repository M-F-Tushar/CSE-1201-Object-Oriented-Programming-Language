name: Java Compilation Check

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**.java'
  pull_request:
    branches: [ main, develop ]
    paths:
      - '**.java'

jobs:
  build:
    name: Build Java Programs
    runs-on: ubuntu-latest
    
    permissions:
      contents: read

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Setup JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Verify Java Installation
      run: |
        echo "üì¶ Java Information:"
        java -version
        javac -version
        echo ""

    - name: Find and Compile Java Files
      run: |
        echo "üîç Finding Java source files..."
        FAILED_FILES=0
        SUCCESS_FILES=0
        TOTAL_FILES=0
        
        while IFS= read -r file; do
          TOTAL_FILES=$((TOTAL_FILES + 1))
          echo ""
          echo "üìù Compiling ($TOTAL_FILES): $file"
          if javac -Xlint:all "$file" 2>&1; then
            echo "‚úÖ Success: $file"
            SUCCESS_FILES=$((SUCCESS_FILES + 1))
          else
            echo "‚ùå Failed: $file"
            FAILED_FILES=$((FAILED_FILES + 1))
          fi
        done < <(find . -name "*.java" -type f)
        
        echo ""
        echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
        echo "üìä Compilation Summary:"
        echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
        echo "Total files:   $TOTAL_FILES"
        echo "‚úÖ Successful: $SUCCESS_FILES"
        echo "‚ùå Failed:     $FAILED_FILES"
        echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
        
        if [ $FAILED_FILES -gt 0 ]; then
          echo ""
          echo "‚ö†Ô∏è  Warning: Some files failed to compile"
          echo "This is expected for educational examples that may contain intentional errors."
          exit 0
        else
          echo ""
          echo "üéâ All files compiled successfully!"
        fi

    - name: Clean Up Class Files
      if: always()
      run: find . -name "*.class" -delete
